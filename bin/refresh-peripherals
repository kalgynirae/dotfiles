#!/bin/bash

# no audible bell
xset -b

# slightly insane keyrepeat
xset r rate 145 55

xkbcomp -I$HOME/dotfiles/xkb $HOME/dotfiles/keymap.xkb $DISPLAY
numlockx

# middle-click with three-finger tap; do nothing with one or two fingers
synclient TapButton1=0 TapButton2=0 TapButton3=2

[[ -f "$XDG_RUNTIME_DIR/display" ]] && display=$(<"$XDG_RUNTIME_DIR/display") || display=0
[[ " $* " == *" --cycle "* ]] && (( display++ ))
echo $display >"$XDG_RUNTIME_DIR/display"

MOUSE_REGEXES=(G502)

case $(hostname) in
    colinchan-fedora-PC166WVV)
        #xrandr \
        #    --output eDP-1 --auto \
        #    --output HDMI-2 --auto --above eDP-1 --primary
        #xrandr \
        #    --output eDP-1 --auto \
        #    --output DP-1 --auto --above eDP-1 --primary
        xrandr \
            --output eDP-1 --auto --pos 0x0 --primary \
            --output DP-1-8 --auto --pos 1920x0 \
            --output DP-1-1 --auto --pos 4480x0

        # Set minimum brightness so the screen won't go entirely black
        light -Nr 1

        MOUSE_REGEXES+=(Touchpad TrackPoint)
        ;;
    lumeh)
        xrandr \
            --output LVDS1 --auto --primary --pos 1920x312 \
            --output HDMI1 --auto --pos 0x0 \
            --output VGA1 --auto --same-as LVDS1
        ;;
    apartmanteau)
        case $(( display % 3 )) in
            0)
                xrandr \
                    --output HDMI-0 --auto --primary \
                    --output DP-1 --off
                ;;
            1)
                xrandr \
                    --output HDMI-0 --off \
                    --output DP-1 --auto --primary
                ;;
            2)
                xrandr \
                    --output HDMI-0 --auto --primary \
                    --output DP-1 --auto --right-of HDMI-0
                ;;
        esac
        ;;
esac

# Figure out the xinput device IDs for mice
list=$(xinput list)
>"$XDG_RUNTIME_DIR/mice"
for regex in "${MOUSE_REGEXES[@]}"; do
  id=$(<<<"$list" sed -n "/$regex/"'s/.*id=\([[:digit:]]\+\).*pointer.*/\1/p')
  if [[ $id ]]; then
    echo "$id" >>"$XDG_RUNTIME_DIR/mice"
  else
    echo >&2 "No device matched regex ${regex@Q}"
  fi
done

~/.fehbg
paplay /usr/share/sounds/freedesktop/stereo/window-attention.oga

#!/bin/bash

wallpaper=$(find ~/pictures/wallpapers -iname '*.png' -o -iname '*.jpg' | shuf -n1)
quotelines=$(shuf -n1 ~/dotfiles/quotes.txt | sed 's/ -- /\n/')
quote="$(head -n-1 <<<"$quotelines" | sed "s/'/’/g" | fmt -w 80 -g 40)"
author="$(tail -n1 <<<"$quotelines")"

formattedquote=$"“$quote”\n— $author"
size=$(xrandr --current | grep primary | grep -Po '\d+x\d+')
position=160,100

dir=$(mktemp -dt generate-wallpaper.XXXX)
# Resize wallpaper
magick "$wallpaper" -resize "$size^" -gravity center -extent "$size" "$dir/resized.png"
# Generate quote
magick \
  -background "#0000" \
  -encoding unicode \
  -fill white \
  -font "Gentium-Basic-Bold" \
  -gravity east \
  -pointsize 48 \
  label:"$formattedquote" \
  -bordercolor "#000a" \
  -border 20 \
  "$dir/quote.png"
# Overlay quote on wallpaper
composite -gravity southeast -geometry +0+100 "$dir/quote.png" "$dir/resized.png" "$dir/wallpaper.png"
echo "$dir/wallpaper.png"
